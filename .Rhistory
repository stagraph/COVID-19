data.frame()%>%
mutate(
TABLE_COLS = paste( .TABLE_NAME,  .TABLE_SCHEM, collapse="|")
)
stg_db_tbl <-
RODBC::sqlTables(channel)[, 2:4] %>%
data.frame()%>%
mutate(
TABLE_COLS = paste( TABLE_NAME,  TABLE_SCHEM, collapse="|")
)
stg_fx <- function(channel, Name, Scheme) {
return(paste(RODBC::sqlColumns(channel, Name, schema = Scheme)[,4], collapse="|"))
}
stg_fx <- function(channel, Name, Scheme) {
return(paste(RODBC::sqlColumns(channel, Name, schema = Scheme)[,4], collapse="|"))
}
stg_db_tbl <-
RODBC::sqlTables(channel)[, 2:4] %>%
data.frame()%>%
mutate(
TABLE_COLS = stg_fx(channel, TABLE_NAME,  TABLE_SCHEM)
)
stg_db_tbl <-
RODBC::sqlTables(channel)[, 2:4] %>%
data.frame()%>%
rowwise() %>%
mutate(
TABLE_COLS = stg_fx(channel, TABLE_NAME,  TABLE_SCHEM)
)
print('Stagraph:dbplyr:OK')
write.table(stg_db_tbl, file= 'C:/Users/MAIND/AppData/Local/Temp/Stagraph/stg_db_tbl.txt', sep = '\t', row.names=FALSE)
write.table(stg_db_tbl, file= 'C:/Users/MAIND/AppData/Local/Temp/Stagraph/stg_db_tbl.txt', sep = '\t', row.names=FALSE)
write.table(stg_db_tbl, file= 'C:/Users/MAIND/AppData/Local/Temp/Stagraph/stg_db_tbl.txt', sep = '\t', row.names=FALSE)
print(paste(nrow(stg_db_tbl), 'tables are available for processing.'))
RODBC::odbcClose(channel)
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
install.packages("install.packages("shinydashboard")")
install.packages("shinydashboard")
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
install.packages("coronavirus")
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
force(coronavirus)
library(coronavirus)
dataset <- data(coronavirus)
dataset <- data(coronavirus)
show(dataset)
show(coronavirus)
coronavirus %>%
order_by(desc(date))
rlang::last_error()
coronavirus %>%
filter(Country.Region == "Slovakia")
coronavirus %>%
filter(Country.Region == "Germany")
coronavirus %>%
distinct(Country.Region)
x<-coronavirus %>%
distinct(Country.Region)
View(x)
coronavirus %>%
summarise(c=sum(cases))
coronavirus %>%
summarise(c=max(date))
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
load_source_data <- function(){
# load confirmed
world_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#load recovered
world_recovered <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Recovered", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#load deaths
world_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#combine all source datasets
finalDataset <- world_confirmed %>%
left_join(world_recovered, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
left_join(world_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat,Long,Date, Cum_Confirmed= Confirmed, Cum_Recovered=Recovered, Cum_Deaths=Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = coalesce(Cum_Recovered - lag(Cum_Recovered,1, order_by = Date),0),
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#return
return(finalDataset)
}
#mutate(Country=replace(Country, Country=="US", "USA"))
# country - state statistics + some cleanning
data_state <- load_source_data() %>%
ungroup()%>%
mutate(Country = case_when(Country == "US"  ~ "USA",
Country == "Czechia"  ~ "Czech Republic",
Country == "Congo (Brazzaville)"  ~ "Republic of Congo",
Country == "Congo (Kinshasa)"  ~ "Democratic Republic of the Congo",
Country == "Cabo Verde"  ~ "Cape Verde",
Country == "Cote d'Ivoire"  ~ "Ivory Coast",
Country == "Korea, South"  ~ "South Korea",
Country == "Taiwan*"  ~ "Taiwan",
Country == "United Kingdom"  ~ "UK",
Country == "North Macedonia"  ~ "Macedonia",
Country == "Burma"  ~ "Myanmar",
TRUE ~ Country))
# country statistics
data_country <- data_state %>%
ungroup()%>%
select(-State)%>%
group_by(Country, Lat, Long, Date)%>%
summarise(Daily_Confirmed = sum(Daily_Confirmed), Daily_Recovered = sum(Daily_Recovered), Daily_Deaths = sum(Daily_Deaths))
# get last date in dataset)
data_last_day <- max(data_state$Date)
# get statistical numbers
data_total_confirmed <- data_country$Daily_Confirmed %>% sum()
data_total_recovered <- data_country$Daily_Recovered %>% sum()
data_total_deaths <- data_country$Daily_Deaths %>% sum()
# get statistical numbers
data_lastDay_confirmed <- data_country %>% ungroup() %>% filter(Date == data_last_day) %>% select(Daily_Confirmed) %>% sum()
data_lastDay_recovered <- data_country %>% ungroup() %>% filter(Date == data_last_day) %>% select(Daily_Recovered) %>% sum()
data_lastDay_deaths <- data_country %>% ungroup() %>% filter(Date == data_last_day) %>% select(Daily_Deaths) %>% sum()
library(maps)
library(ggplot2)
data_world_map = map_data("world") %>%
mutate(region = case_when(region == "Antigua"  ~ "Antigua and Barbuda",
region == "Barbuda"  ~ "Antigua and Barbuda",
region == "Trinidad"  ~ "Trinidad and Tobago",
region == "Tobago"  ~ "Trinidad and Tobago",
region == "Saint Vincent"  ~ "Saint Vincent and the Grenadines",
region == "Grenadines"  ~ "Saint Vincent and the Grenadines",
TRUE ~ region))
temp_data <- data_world_map %>%
left_join(data_country %>%  group_by(Country) %>% summarise(Value = sum(Daily_Confirmed) )
, by=c("region"="Country"))
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
install.packages("shinycssloaders")
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
install.packages("DT")
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp()
runApp()
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
shiny::runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
library(dplyr)
library(readr)
library(tidyr)
library(lubridate)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#load deaths
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv")
View(us_confirmed)
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key,)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, USA= "USA")
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_, -Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
View(us_confirmed)
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country) %>%
summarise(
Daily_Confirmed = sum("Confirmed"),
Lat = mean(Lat),
Long = mean(Long)
)
str(us_confirmed)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Confirmed = sum("Confirmed"),
Lat = mean(Lat),
Long = mean(Long)
)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Confirmed = sum("Confirmed"),
Lat = mean(Lat),
Long = mean(Long)
)
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Confirmed = sum("Confirmed"),
Lat = mean(Lat),
Long = mean(Long)
)
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Confirmed = sum(Confirmed),
Lat = mean(Lat),
Long = mean(Long)
)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Deaths = sum(Deaths),
Lat = mean(Lat),
Long = mean(Long)
)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv")
View(us_deaths)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key,- Population, Long=Long_) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Deaths = sum(Deaths),
Lat = mean(Lat),
Long = mean(Long)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(world_recovered, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat,Long,Date, Cum_Confirmed= Confirmed, Cum_Recovered=Recovered, Cum_Deaths=Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat,Long,Date, Cum_Confirmed= Confirmed, Cum_Recovered=Recovered, Cum_Deaths=Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date"))
View(final_us_Dataset)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Confirmed, Cum_Deaths=Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Cum_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key,- Population, Long=Long_) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Deaths = sum(Deaths),
Lat = mean(Lat),
Long = mean(Long)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Cum_Confirmed = NA,
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Cum_Recovered = NA,
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Cum_Recovered = NA,
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)%>%
select(Country, State, Lat, Long, Date, Cum_Confirmed, Cum_Recovered,Cum_Deaths, Daily_Confirmed, Daily_Recovered, Daily_Deaths)
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
library(dplyr)
library(readr)
library(tidyr)
library(lubridate)
load_source_data <- function(){
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#load deaths
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province/State', Country = 'Country/Region' ) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))
#combine all source datasets
finalDataset <- world_confirmed %>%
left_join(world_recovered, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
left_join(world_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(Country,State, Lat,Long,Date, Cum_Confirmed= Confirmed, Cum_Recovered=Recovered, Cum_Deaths=Deaths) %>%
group_by(Country,State, Lat,Long) %>%
mutate(Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = coalesce(Cum_Recovered - lag(Cum_Recovered,1, order_by = Date),0),
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)
#return
return(finalDataset)
}
load_us_data <- function(){
# load confirmed
us_confirmed <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key, Long=Long_) %>%
gather(key="Date", value = "Confirmed", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Confirmed = sum(Confirmed),
Lat = mean(Lat),
Long = mean(Long)
)
us_deaths <- read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv") %>%
dplyr::rename(State = 'Province_State', Country = 'Country_Region' ) %>%
select(-UID, -iso2,-iso3, -code3, -FIPS,-Admin2, -Combined_Key,- Population, Long=Long_) %>%
gather(key="Date", value = "Deaths", -State, -Country, -Lat, -Long) %>%
mutate(Date = mdy(Date))%>%
group_by(State, Country, Date) %>%
summarise(
Daily_Deaths = sum(Deaths),
Lat = mean(Lat),
Long = mean(Long)
)
#combine all source datasets
final_us_Dataset <- us_confirmed %>%
left_join(us_deaths, by = c("State"="State", "Country"="Country", "Date"="Date")) %>%
select(State, Lat=Lat.x,Long=Long.x,Date, Cum_Confirmed= Daily_Confirmed, Cum_Deaths=Daily_Deaths) %>%
group_by(State, Lat,Long) %>%
mutate(
Country = "USA",
Cum_Recovered = NA,
Daily_Confirmed = coalesce(Cum_Confirmed - lag(Cum_Confirmed,1, order_by = Date),0),
Daily_Recovered = NA,
Daily_Deaths = coalesce(Cum_Deaths - lag(Cum_Deaths,1, order_by = Date),0)
)%>%
select(Country, State, Lat, Long, Date, Cum_Confirmed, Cum_Recovered,Cum_Deaths, Daily_Confirmed, Daily_Recovered, Daily_Deaths)
return(final_us_Dataset)
}
# country - state statistics + some cleanning
data_state2 <- load_us_data()
data_state <- load_source_data %>%
filter(Country != "US")
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
rescale(1:100)
scales::rescale(1:100)
scales::rescale(1:100, 5,10)
scales::rescale(1:100, from=5,to=10)
rescale(1:100, to = c(0, 1), from = range(1:100, na.rm =
TRUE, finite = TRUE), ...)
scales::rescale(1:100, to = c(0, 1), from = range(1:100, na.rm =
TRUE, finite = TRUE), ...)
scales::rescale(1:100, to = c(0, 1), from = range(1:100, na.rm =
TRUE, finite = TRUE))
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
runApp('D:/Projekty/2020 - Corona - nove prilezitosti/app/COVID-19')
